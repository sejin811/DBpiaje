<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DBpiaje | Ask Page</title>
  <link rel="icon" href="img/pepe.jpeg" type="image/png" />
  <link rel="stylesheet" href="style2.css" />
  <style>
    .banner {
      background-image: url('https://img.freepik.com/fotos-kostenlos/welliger-schwarz-weisser-hintergrund_23-2150530917.jpg?semt=ais_hybrid&w=740');
      background-size: cover;
      background-position: center;
      color: red;
      text-align: center;
      font-family: Arial, sans-serif;
      height: 120px;
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0;
    }

    .banner h1 {
      font-size: 4rem;
      margin: 0;
    }

    .banner p {
      font-size: 1rem;
      margin: 5px 0 0 0;
    }

    @media (max-width: 600px) {
      .banner {
        height: 100px;
      }

      .banner h1 {
        font-size: 7vw;
      }

      .banner p {
        font-size: 0.9rem;
      }
    }

    .comment-card {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px;
      border-radius: 8px;
      background: #f9f9f9;
    }

    .delete-button {
      background: red;
      color: white;
      border: none;
      padding: 5px 10px;
      margin-top: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="banner">
    <h1><i>DBpiaje</i>ğŸ•“-ë¬¸ì˜ í˜ì´ì§€</h1>
  </div>


  <!-- ì‚¬ì´ë“œë°” toggle ë²„íŠ¼ -->
  <button id="toggleSidebar" class="sidebar-toggle">â˜°</button>

  <aside id="sidebar" class="sidebar">
    <h3>ã…¤</h3>
    <a class="menu-button" href="index.html">ğŸ í™ˆ</a>
    <a class="menu-button" href="paper.html">ğŸ“„ë…¼ë¬¸</a>
    <a class="menu-button" href="community.html">ğŸ’¬ê³µì‹ ì»¤ë®¤ë‹ˆí‹°</a>
    <a class="menu-button" href="ask.html">â“ë¬¸ì˜</a>
    <a class="menu-button" href="patch_note.html">ğŸ“íŒ¨ì¹˜ ë…¸íŠ¸</a>
    <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
    <div class="toggle-container">
      <label class="switch">
        <input type="checkbox" id="darkModeToggle">
        <span class="slider round"></span>
      </label>
      <span class="toggle-label">ë‹¤í¬ëª¨ë“œğŸŒ™</span>
  </aside>

  <!-- ê³µì§€ì‚¬í•­ -->
  <div class="notice-box">
    <h2>ğŸ“¢ ê³µì§€ì‚¬í•­</h2>
    <b>ëŒ“ê¸€ì— ììœ ë¡­ê²Œ ì˜ê²¬ì„ ì¨ë³´ì„¸ìš”!<br>ë¬¸ì˜ ì´ë©”ì¼ ì£¼ì†Œ <b
        style="color: rgb(89, 89, 250);">dbpiaje@gmail.com</b></b>
    <br><br>
    <b style="color: rgb(245, 101, 30);">[ìì£¼ ë¬»ëŠ” ì§ˆë¬¸]</b><br>
    <b>Q. ë…¼ë¬¸ì„ ê¸°ì¬í•˜ê³  ì‹¶ì€ë° ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?</b><br>
    <b>A. ìœ„ì˜ ì´ë©”ì¼ë¡œ ë…¼ë¬¸(png, pdfë“±)ì„ ë³´ë‚´ì£¼ì‹œë©´ ê²€í†  í›„ ê¸°ì¬í•´ ë“œë¦½ë‹ˆë‹¤.</b><br><br>
    <b>Q. ë…¼ë¬¸ ì£¼ì œëŠ” ê¼­ 'ì–‘ì¬ì„ 'ì´ë¼ëŠ” ìƒëª…ì²´ì™€ ê´€ë ¨ì´ ìˆì–´ì•¼ í•˜ë‚˜ìš”?</b><br>
    <b>A. ë…¼ë¬¸ ì£¼ì œëŠ” ììœ ì…ë‹ˆë‹¤.</b><br><br>
    <b>Q. ê°œë°œìì—ê²Œ í›„ì›í•˜ê³  ì‹¶ì€ë° ì–´ë–»ê²Œ í•´ì•¼í•˜ë‚˜ìš”? (ê¸‰í•¨ ã… ã… )</b><br>
    <b>A. 7777032890798 ì¹´ì¹´ì˜¤ë±…í¬ğŸ¥´</b>
  </div>

  <form id="commentForm">
    <input type="text" id="name" placeholder="ì´ë¦„" required />
    <textarea id="comment" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
    <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
  </form>

  <div id="commentList"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

  <!--ëŒ“ê¸€ ê¸°ëŠ¥ êµ¬í˜„ì„ ìœ„í•œ firebase ì…‹íŒ…ê³¼ ëŒ“ê¸€ ê¸°ëŠ¥ script-->
  <script>

    const firebaseConfig = {
      apiKey: "AIzaSyCm6nslSJF8RQgjN3h4z-awLbObhM1FTVw",
      authDomain: "dbpiaje.firebaseapp.com",
      projectId: "dbpiaje",
      storageBucket: "dbpiaje.firebasestorage.app",
      messagingSenderId: "590808126930",
      appId: "1:590808126930:web:4eb9e5e754674435df240b",
      measurementId: "G-LGKY04RMLR"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let isAdmin = false;
    let pendingDeleteId = null;

    document.getElementById("commentForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const comment = document.getElementById("comment").value;

      db.ref("comments").push({
        name,
        comment,
        created_at: new Date().toISOString()
      });

      document.getElementById("commentForm").reset();
    });

    function loadComments() {
      db.ref("comments").on("value", snapshot => {
        const data = snapshot.val();
        const list = document.getElementById("commentList");
        list.innerHTML = "";

        if (!data) return;

        // ëŒ“ê¸€ì„ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³ , ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
        const sortedComments = Object.entries(data).sort((a, b) => {
          return new Date(b[1].created_at) - new Date(a[1].created_at);
        });

        // ì •ë ¬ëœ ëŒ“ê¸€ ë Œë”ë§
        for (let [id, c] of sortedComments) {
          const div = document.createElement("div");
          div.className = "comment-card";

          const content = document.createElement("div");
          content.innerHTML = `<strong>${c.name}</strong> (${new Date(c.created_at).toLocaleString()}):<br>${c.comment}`;

          div.appendChild(content);

          const delBtn = document.createElement("button");
          delBtn.textContent = "ì‚­ì œ";
          delBtn.className = "delete-button";
          delBtn.onclick = () => requestDelete(id);
          div.appendChild(delBtn);

          list.appendChild(div);
        }
      });
    }

    // ì‚­ì œ ìš”ì²­ ì‹œ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ìš”êµ¬
    function requestDelete(id) {
      if (isAdmin) {
        if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          db.ref("comments/" + id).remove();
        }
      } else {
        pendingDeleteId = id;
        document.getElementById("adminModal").style.display = "flex";
      }
    }

    // SHA-256 í•´ì‹œ í•¨ìˆ˜
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    const adminPasswordHash = "1a36ea191cd5abd1c2ebd694de6dc5f1bb83661a77176d1b5524645b2ec00668";
    // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œê°’

    async function verifyAdmin() {
      const pw = document.getElementById("adminPassword").value;
      const hash = await sha256(pw);
      if (hash === adminPasswordHash) {
        isAdmin = true;
        document.getElementById("adminModal").style.display = "none";
        document.getElementById("adminError").style.display = "none";

        if (pendingDeleteId) {
          db.ref("comments/" + pendingDeleteId).remove();
          pendingDeleteId = null;
        }

        document.getElementById("adminPassword").addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            verifyAdmin();
          }
        });

        loadComments();
      } else {
        document.getElementById("adminError").style.display = "block";
      }
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ëŒ“ê¸€ë§Œ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = function () {
      loadComments();

      // ì—”í„°í‚¤ë¡œ ê´€ë¦¬ì ì¸ì¦
      document.getElementById("adminPassword").addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          verifyAdmin();
        }
      });
    };

    //ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ ëˆ„ë¥¼ ì‹œ ë‚˜ì˜¤ëŠ” ê´€ë¦¬ì ì¸ì¦ ì°½ ì·¨ì†Œ ê¸°ëŠ¥ êµ¬í˜„
    function cancelAdmin() {
      document.getElementById("adminModal").style.display = "none";
      document.getElementById("adminPassword").value = "";
      document.getElementById("adminError").style.display = "none";
      pendingDeleteId = null; // ì‚­ì œ ëŒ€ê¸° ì·¨ì†Œ
    }

  </script>

  <footer class="footer">
    <p>â“’ 2025 DBpiaje. All rights reserved.</p>
    <p>ë¬¸ì˜: dbpiaje@gmail.com</p>
  </footer>

  <!-- ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
  <div id="adminModal" class="modal-overlay">
    <div class="modal-box">
      <h2>ê´€ë¦¬ì ì¸ì¦</h2>
      <input type="password" id="adminPassword" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
      <div style="margin-top: 15px;">
        <button onclick="verifyAdmin()">í™•ì¸</button>
        <button onclick="cancelAdmin()">ì·¨ì†Œ</button>
      </div>
      <p id="adminError" style="color: red; display: none;">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</p>
    </div>
  </div>

  <!--ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ ê´€ë ¨-->
  <style>
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      /* ê¸°ë³¸ê°’ì„ noneìœ¼ë¡œ ë°”ê¿ˆ */
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal-box {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      text-align: center;
    }

    .modal-box input {
      padding: 10px;
      width: 80%;
      margin-top: 10px;
    }

    .modal-box button {
      margin-top: 15px;
      padding: 10px 20px;
    }
  </style>
  <script src="javascript/sidebar.js"></script>
</body>

</html>